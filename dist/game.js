!function(e){var t={};function n(r){if(t[r])return t[r].exports;var s=t[r]={i:r,l:!1,exports:{}};return e[r].call(s.exports,s,s.exports,n),s.l=!0,s.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)n.d(r,s,function(t){return e[t]}.bind(null,s));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=20)}([function(e,t,n){"use strict";var r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});const s=r(n(2)),o=r(n(3)),i=o.createConnection({host:s.HOST,port:s.PORT,user:s.USER,password:s.PASS,database:s.DB});class u{constructor(e){this.table=e}static parseExpression(e){const t=[];return e.forEach(e=>{const n=e=>t.push(`${r}=${e}`),r=Object.keys(e)[0],s=e[r];switch(typeof s){case"string":n(`"${s}"`);break;case"number":n(s);break;case"object":n(o.escape(JSON.stringify(s)))}}),t}find(...e){return new Promise((t,n)=>{const r=u.parseExpression(e);i.query(`SELECT * FROM ${this.table} WHERE ${r.join(" , ")}`,(e,r)=>{e?n(e):t(r)})})}findOne(...e){return new Promise((t,n)=>{const r=u.parseExpression(e);i.query(`SELECT * FROM ${this.table} WHERE ${r.join(" , ")}`,(e,r)=>{e?n(e):t(r[0])})})}add(...e){return new Promise((t,n)=>{const r=e.map(e=>"object"==typeof e?`'${JSON.stringify(e)}'`:`"${e}"`);i.query(`INSERT INTO ${this.table} VALUES (${r.join(" , ")})`,e=>{e?n(e):t()})})}update(e,t){return new Promise((n,r)=>{const s=u.parseExpression(e),o=u.parseExpression(t);i.query(`UPDATE ${this.table} SET ${o.join(" , ")} WHERE ${s.join(" ")}`,e=>{e?r(e):n()})})}delete(e){return new Promise((t,n)=>{const r=u.parseExpression(e);i.query(`DELETE FROM ${this.table} WHERE ${r.join(" ")}`,e=>{e?n(e):t()})})}}t.default={TABLE:{users:new u("users"),item:new u("item"),session:new u("session"),mobs:new u("mobs"),boss:new u("boss")}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=class{static time(){const e=new Date;return[e.getFullYear(),"-",e.getMonth()+1,"-",e.getDate()," ",e.getHours(),":",e.getMinutes(),":",e.getSeconds(),":",e.getMilliseconds()].join("")}static random(e,t){return Math.floor(Math.random()*(t-e+1)+e)}}},function(e){e.exports=JSON.parse('{"PORT":3306,"HOST":"localhost","USER":"root","PASS":"ckfejrvkdl4!","DB":"step-by-step"}')},function(e,t){e.exports=require("mysql")},function(e){e.exports=JSON.parse('{"clientID":"85980254947-tbpk5bogtbg9egmsievv1gbmrtmsibel.apps.googleusercontent.com","clientSecret":"vepcxiwShQNOQMLllW8t_VOZ","callbackURL":"http://lotix.kro.kr/auth/google/callback","SESSION_SECRET":"TEST1234"}')},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(n(1));t.default=class{constructor(e,t="green"){this.label=e,this.color=t}trace(e){console.log(`${this.label} | ${s.default.time()} | ${e}`)}}},function(e){e.exports=JSON.parse('{"INTERNAL_WS_URL":"127.0.0.2","WS_PORT":7010}')},,,,,,,,,,,,,,function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(s,o){function i(e){try{a(r.next(e))}catch(e){o(e)}}function u(e){try{a(r.throw(e))}catch(e){o(e)}}function a(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,u)}a((r=r.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}},o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});const i=s(n(21)),u=s(n(22)),a=s(n(23)),c=o(n(6)),d=o(n(24)),l=o(n(25)),f=o(n(4)),p=s(n(0)),b=s(n(5)),h=s(n(1)),S=u.default.createServer(),E=i.default(S),v=new b.default("GAME","blue"),O={};E.on("connection",e=>r(void 0,void 0,void 0,(function*(){const t=e.id,n=e.handshake.headers.host.split(":")[0];if(n===c.INTERNAL_WS_URL)v.trace("Web server connected."),e.on("disconnect",()=>{v.trace("Web server died.")});else if("127.0.0.3"===n)v.trace("Server Manager connected.");else{v.trace(`Client ${e.id} connected.`);const n=d.parse(e.handshake.headers.cookie)["connect.sid"],s=l.signedCookie(n,f.SESSION_SECRET),o=JSON.parse((yield p.default.TABLE.session.findOne({id:s})).profile).id,i=yield p.default.TABLE.users.findOne({id:o});i.inventory=JSON.parse(i.inventory),i.stat=JSON.parse(i.stat),i.equip=JSON.parse(i.equip),console.log(i.level),O[t]=new a.default(e,t,o),O[t].send("enter",i),function(e){const t=e.id;e.on("searchMob",()=>r(this,void 0,void 0,(function*(){const e=(yield p.default.TABLE.users.findOne({id:O[t].userID})).stage,n=yield p.default.TABLE.mobs.find({stage:e});O[t].send("detectMob",n[h.default.random(0,n.length-1)])}))),e.on("upgradeItem",(e,n,s)=>r(this,void 0,void 0,(function*(){const r=yield p.default.TABLE.users.findOne({id:O[t].userID}),o=JSON.parse(r.inventory);for(const t in s)o[e].upgradedStat[t]||(o[e].upgradedStat[t]=0),o[e].upgradedStat[t]+=s[t];o[e].stat=n,o[e].upgradeLv+=1,yield p.default.TABLE.users.update([{id:O[t].userID}],[{inventory:o}]),O[t].send("upgradeResponse",{id:e,data:o[e]})}))),e.on("bossfight",e=>r(this,void 0,void 0,(function*(){const n=yield p.default.TABLE.users.findOne({id:O[t].userID});(yield p.default.TABLE.boss.findOne({id:e})).reqLv>n.level?O[t].send("bossfightEnter",{canEnter:!1,boss:e}):O[t].send("bossfightEnter",{canEnter:!0,boss:e})})))}(e)}}))),S.listen(c.WS_PORT,()=>{v.trace("Game Server opened : "+c.WS_PORT)})},function(e,t){e.exports=require("socket.io")},function(e,t){e.exports=require("http")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r{constructor(e,t,n){this.socket=e,this.id=t,this.userID=n}send(e,...t){this.socket.emit(e,...t)}}t.default=r,e.exports=r},function(e,t){e.exports=require("cookie")},function(e,t){e.exports=require("cookie-parser")}]);
//# sourceMappingURL=game.js.map